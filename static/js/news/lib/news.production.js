(function(){var i,g,h,d,j=Object.prototype.hasOwnProperty,f=function(a,b){function c(){this.constructor=a}for(var e in b)if(j.call(b,e))a[e]=b[e];c.prototype=b.prototype;a.prototype=new c;a.__super__=b.prototype;return a};i=function(){function a(b){var c,e;a.__super__.constructor.apply(this,arguments);this.set("author",b.author);this.set("content",b.content);if(b.date){c=Date.parseExact(b.date,"yyyy-MM-ddTHH:mm:ssZ");e=c.toString("dd MMM yyyy, HH:mm");this.attributes.displayDate=e;c=c.toString("yyyy-MM-dd-HH-mm-ss");
this.id=c+"/"}}f(a,Backbone.Model);a.prototype.url="/news/microposts/";a.prototype.getAuthor=function(){return this.get("author")};a.prototype.getDate=function(){return this.get("date")};a.prototype.getContent=function(){return this.get("content")};a.prototype["delete"]=function(){this.url+=this.id;this.destroy();return this.view.remove()};a.prototype.isNew=function(){return!this.getAuthor()};return a}();g=function(){function a(){a.__super__.constructor.apply(this,arguments)}f(a,Backbone.Collection);
a.prototype.model=i;a.prototype.url="/news/microposts/";a.prototype.comparator=function(b){return b.getDate()};a.prototype.parse=function(b){return b.rows};return a}();h=function(){function a(b){this.model=b;a.__super__.constructor.apply(this,arguments);this.id="micropost-"+this.model.id;this.model.view=this}f(a,Backbone.View);a.prototype.tagName="div";a.prototype.className="news-micropost-row";a.prototype.template=_.template('<a class="news-micropost-delete">X</a>\n<p class="news-micropost-content">\n <span><%= author %></span>\n <%= content %>\n</p>\n<p class="news-micropost-date">\n <%= displayDate%>\n</p>');
a.prototype.events={"click .news-micropost-delete":"onDeleteClicked",mouseover:"onMouseOver",mouseout:"onMouseOut"};a.prototype.onMouseOver=function(){return this.$(".news-micropost-delete").show()};a.prototype.onMouseOut=function(){return this.$(".news-micropost-delete").hide()};a.prototype.onDeleteClicked=function(){return this.model["delete"]()};a.prototype.remove=function(){return $(this.el).remove()};a.prototype.render=function(){$(this.el).html(this.template(this.model.toJSON()));this.$(".news-micropost-delete").button();
this.$(".news-micropost-delete").hide();return this.el};return a}();d=new (function(){function a(){a.__super__.constructor.apply(this,arguments)}f(a,Backbone.View);a.prototype.el=$("#news");a.prototype.isCtrl=false;a.prototype.events={"click #news-post-button":"onPostClicked","submit #news-post-button":"onPostClicked","click #news-my-button":"onMineClicked","click #news-more":"onMoreNewsClicked"};a.prototype.initialize=function(){_.bindAll(this,"postNewPost","appendOne","prependOne","addAll");_.bindAll(this,
"displayMyNews","onMoreNewsClicked","addAllMore");_.bindAll(this,"onDatePicked");this.microposts=new g;this.microposts.bind("add",this.prependOne);this.microposts.bind("refresh",this.addAll);this.moreMicroposts=new g;return this.moreMicroposts.bind("refresh",this.addAllMore)};a.prototype.onKeyUp=function(b){if(b.keyCode===17)this.isCtrl=false;return b};a.prototype.onKeyDown=function(b){if(b.keyCode===17)this.isCtrl=true;if(b.keyCode===13&&this.isCtrl){this.isCtrl=false;this.postNewPost()}return b};
a.prototype.onPostClicked=function(b){b.preventDefault();this.postNewPost();return b};a.prototype.onMineClicked=function(b){this.clearNews(null);this.reloadMicroPosts();this.displayMyNews();return b};a.prototype.onDatePicked=function(b){b=Date.parse(b).toString("yyyy-MM-dd");this.clearNews();return this.reloadMicroPosts(b)};a.prototype.clearNews=function(){$("#micro-posts").empty();return $("#news-more").show()};a.prototype.addAllMore=function(){var b;b=this.moreMicroposts.toArray().reverse();b=_.rest(b);
_.each(b,this.appendOne);this.lastDate=this.moreMicroposts.last().id;b.length<10&&$("#news-more").hide();return this.lastDate};a.prototype.addAll=function(){this.microposts.each(this.prependOne);if(this.microposts.length>0){this.lastDate=this.microposts.first().id;this.microposts.length<10&&$("#news-more").hide()}else $("#news-more").hide();return this.microposts.length};a.prototype.appendOne=function(b){var c;c=new h(b);b=c.render();$("#micro-posts").append(b);return c};a.prototype.prependOne=function(b){var c;
c=new h(b);b=c.render();$("#micro-posts").prepend(b);return c};a.prototype.clearPostField=function(){$("#id_content").val(null);$("#id_content").focus();return $("#id_content")};a.prototype.reloadMicroPosts=function(b){this.microposts.url="/news/microposts/";if(b)this.microposts.url="/news/microposts/"+b+"-23-59-00/";this.microposts.fetch();return this.microposts};a.prototype.fetch=function(){this.microposts.fetch();return this.microposts};a.prototype.postNewPost=function(){this.microposts.create({content:$("#id_content").val()});
$("#id_content").val(null);$("#id_content").focus();return false};a.prototype.onMoreNewsClicked=function(){this.moreMicroposts.url=this.lastDate?"/news/microposts/"+this.lastDate:"/news/microposts/";this.moreMicroposts.fetch();return this.moreMicroposts};a.prototype.setListeners=function(){$("#id_content").keyup(function(b){return d.onKeyUp(b)});$("#id_content").keydown(function(b){return d.onKeyDown(b)});return $("input#news-from-datepicker").datepicker({onSelect:this.onDatePicked})};a.prototype.setWidgets=
function(){$("input#news-post-button").button();$("#news-my-button").button();$("#news-all-button").button();$("#news-all-button").button("disable");$("#news-more").button();$("#news-from-datepicker").val(null);return $("#news-a").addClass("disabled")};return a}());d.setWidgets();d.setListeners();d.clearPostField();d.fetch()}).call(this);
