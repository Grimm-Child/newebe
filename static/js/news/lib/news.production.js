(function(){var j,k,g,h,d,e,l=Object.prototype.hasOwnProperty,f=function(b,a){function c(){this.constructor=b}for(var i in a)if(l.call(a,i))b[i]=a[i];c.prototype=a.prototype;b.prototype=new c;b.__super__=a.prototype;return b};(function(){function b(){var a;a=document.createElement("div");a.id="info-dialog";a.innerHTML="Test";$("body").prepend(a);this.element=$("#info-dialog");this.element.hide()}b.prototype.display=function(a){this.element.empty();this.element.append(a);this.element.show();return this.element.fadeOut(4E3)};
return b})();j=function(){function b(){var a;a=document.createElement("div");a.id="loading-indicator";a.innerHTML='<img src="/static/images/clock_32.png" />';$("body").prepend(a);this.element=$("#loading-indicator");this.element.hide()}b.prototype.display=function(){return this.element.show()};b.prototype.hide=function(){return this.element.hide()};return b}();k=function(){function b(a){var c;b.__super__.constructor.apply(this,arguments);this.set("author",a.author);this.set("content",a.content);this.set("authorKey",
a.authorKey);if(a.date){c=this.setDisplayDateFromDbDate(a.date);c=c.toString("yyyy-MM-dd-HH-mm-ss");this.id=c+"/"}}f(b,Backbone.Model);b.prototype.url="/news/microposts/";b.prototype.setDisplayDateFromDbDate=function(a){a=Date.parseExact(a,"yyyy-MM-ddTHH:mm:ssZ");this.attributes.displayDate=a.toString("dd MMM yyyy, HH:mm");return a};b.prototype.setDisplayDate=function(){return this.setDisplayDateFromDbDate(this.attributes.date)};b.prototype.getAuthor=function(){return this.get("author")};b.prototype.getDate=
function(){return this.get("date")};b.prototype.getContent=function(){return this.get("content")};b.prototype.getDisplayDate=function(){return this.attributes.displayDate};b.prototype["delete"]=function(){this.url+=this.id;this.destroy();return this.view.remove()};b.prototype.isNew=function(){return!this.getAuthor()};return b}();g=function(){function b(){b.__super__.constructor.apply(this,arguments)}f(b,Backbone.Collection);b.prototype.model=k;b.prototype.url="/news/microposts/";b.prototype.comparator=
function(a){return a.getDate()};b.prototype.parse=function(a){return a.rows};return b}();h=function(){function b(a){this.model=a;b.__super__.constructor.apply(this,arguments);this.id="micropost-"+this.model.id;this.model.view=this}f(b,Backbone.View);b.prototype.tagName="div";b.prototype.className="news-micropost-row";b.prototype.template=_.template('<a class="news-micropost-delete">X</a>\n<p class="news-micropost-content">\n <span><%= author %></span>\n <%= content %>\n</p>\n<p class="news-micropost-date">\n <%= displayDate %>\n</p>');
b.prototype.events={"click .news-micropost-delete":"onDeleteClicked",mouseover:"onMouseOver",mouseout:"onMouseOut"};b.prototype.onMouseOver=function(){return this.$(".news-micropost-delete").show()};b.prototype.onMouseOut=function(){return this.$(".news-micropost-delete").hide()};b.prototype.onDeleteClicked=function(){return this.model["delete"]()};b.prototype.remove=function(){return $(this.el).remove()};b.prototype.render=function(){this.model.getDisplayDate()||this.model.setDisplayDate();$(this.el).html(this.template(this.model.toJSON()));
this.$(".news-micropost-delete").button();this.$(".news-micropost-delete").hide();return this.el};return b}();e=new (function(){function b(){b.__super__.constructor.apply(this,arguments)}f(b,Backbone.View);b.prototype.el=$("#news");b.prototype.isCtrl=false;b.prototype.events={"click #news-post-button":"onPostClicked","submit #news-post-button":"onPostClicked","click #news-my-button":"onMineClicked","click #news-more":"onMoreNewsClicked"};b.prototype.initialize=function(){_.bindAll(this,"postNewPost",
"appendOne","prependOne","addAll");_.bindAll(this,"displayMyNews","onMoreNewsClicked","addAllMore");_.bindAll(this,"onDatePicked");this.tutorialOn=true;this.microposts=new g;this.microposts.bind("add",this.prependOne);this.microposts.bind("refresh",this.addAll);this.moreMicroposts=new g;return this.moreMicroposts.bind("refresh",this.addAllMore)};b.prototype.onKeyUp=function(a){if(a.keyCode===17)this.isCtrl=false;return a};b.prototype.onKeyDown=function(a){if(a.keyCode===17)this.isCtrl=true;if(a.keyCode===
13&&this.isCtrl){this.isCtrl=false;this.postNewPost()}return a};b.prototype.onPostClicked=function(a){a.preventDefault();this.postNewPost();return a};b.prototype.onMineClicked=function(a){this.clearNews(null);this.reloadMicroPosts();this.displayMyNews();return a};b.prototype.onDatePicked=function(a){a=Date.parse(a).toString("yyyy-MM-dd");this.clearNews();return this.reloadMicroPosts(a)};b.prototype.clearNews=function(){$("#micro-posts").empty();return $("#news-more").show()};b.prototype.addAllMore=
function(){var a;a=this.moreMicroposts.toArray().reverse();a=_.rest(a);_.each(a,this.appendOne);this.lastDate=this.moreMicroposts.last().id;a.length<10&&$("#news-more").hide();d.hide();return this.lastDate};b.prototype.addAll=function(){if(this.microposts.length>0){this.tutorialOn=false;this.lastDate=this.microposts.first().id;this.microposts.length<10&&$("#news-more").hide()}else{this.tutorialOn?this.displayTutorial(1):$("#tutorial").html(null);$("#news-more").hide()}this.microposts.each(this.prependOne);
d.hide();return this.microposts.length};b.prototype.appendOne=function(a){var c;c=new h(a);a=c.render();$("#micro-posts").append(a);return c};b.prototype.prependOne=function(a){var c;c=new h(a);a=c.render();$("#micro-posts").prepend(a);d.hide();if(this.tutorialOn){this.displayTutorial(2);this.tutorialOn=false}return c};b.prototype.displayTutorial=function(a){return $.get("/news/tutorial/"+a+"/",function(c){return $("#tutorial").html(c)})};b.prototype.clearPostField=function(){$("#id_content").val(null);
$("#id_content").focus();return $("#id_content")};b.prototype.reloadMicroPosts=function(a){d.display();this.microposts.url="/news/microposts/";if(a)this.microposts.url="/news/microposts/"+a+"-23-59-00/";this.microposts.fetch();return this.microposts};b.prototype.fetch=function(){this.microposts.fetch();return this.microposts};b.prototype.postNewPost=function(){d.display();this.microposts.create({content:$("#id_content").val()},{success:function(){return d.hide()}});$("#id_content").val(null);$("#id_content").focus();
return false};b.prototype.onMoreNewsClicked=function(){d.display();this.moreMicroposts.url=this.lastDate?"/news/microposts/"+this.lastDate:"/news/microposts/";this.moreMicroposts.fetch();return this.moreMicroposts};b.prototype.setListeners=function(){$("#id_content").keyup(function(a){return e.onKeyUp(a)});$("#id_content").keydown(function(a){return e.onKeyDown(a)});return $("input#news-from-datepicker").datepicker({onSelect:this.onDatePicked})};b.prototype.setWidgets=function(){$("input#news-post-button").button();
$("#news-my-button").button();$("#news-all-button").button();$("#news-all-button").button("disable");$("#news-more").button();$("#news-from-datepicker").val(null);return $("#news-a").addClass("disabled")};return b}());d=new j;e.setWidgets();e.setListeners();e.clearPostField();e.fetch()}).call(this);
